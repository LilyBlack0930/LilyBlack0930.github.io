<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="兔兔"><title>NoneBot搭建经验总结 · 兔兔实验室</title><meta name="description" content="看见发布的这条，就说明我正在逐渐退出Dice!了。因为以后还得在服务器上这么做一次……所以赶紧总结一下经验。

前置-环境配置Python刚好这个学期学的是Python所以配过了。略过不讲。Python版本必须≥3.7.3。重点是设置环境变量，在安装Python的时候必须勾选，不然后续会很麻烦。
支"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.webp"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">首页</a></li><li> <a href="/archives">归档</a></li><li> <a href="/tags">标签</a></li><li> <a href="/about">关于</a></li><li> <a href="/links">友链</a></li><li> <a href="/guestbook">留言</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/logo.webp"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.webp" style="width:200px;" alt="favicon"><h3 title=""><a href="/">兔兔实验室</a></h3><div class="description"><p>你踩到了落在地上的纸张，然后摔倒了——</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/LilyBlack0930"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=1142145792"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> 兔兔</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>NoneBot搭建经验总结</a></h3></div><div class="post-content"><p><script type="text/javascript" src="/js/clicklove.js"></script>
<p>看见发布的这条，就说明我正在逐渐退出Dice!了。<br>因为以后还得在服务器上这么做一次……所以赶紧总结一下经验。</p>
<hr>
<h1 id="前置-环境配置"><a href="#前置-环境配置" class="headerlink" title="前置-环境配置"></a>前置-环境配置</h1><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>刚好这个学期学的是Python所以配过了。略过不讲。<br>Python版本必须≥<strong>3.7.3</strong>。<br>重点是设置环境变量，在安装Python的时候必须勾选，不然后续会很麻烦。</p>
<h2 id="支持-py文件的编辑器（Visual-Studio-Code）"><a href="#支持-py文件的编辑器（Visual-Studio-Code）" class="headerlink" title="支持.py文件的编辑器（Visual Studio Code）"></a>支持.py文件的编辑器（Visual Studio Code）</h2><p>本来学期初下载了PyCharm，不过既然视频教程里用的是VS Code，也就下载一个吧。<br>并且实际使用下来，VS Code在这方面比PyCharm略微好用一些。<br>在<strong>微软商店</strong><em>（听说较快）</em>或<a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/?dv=win"><strong>官方网站</strong></a><em>（这个链接打开后直接下载，很慢）</em>下载VS Code安装包，自行选择安装环境。<br>打开VS Code，选择左列小方块图标，搜索并安装以下扩展：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chinese (Simplified) (简体中文) Language Pack for Visual Studio Code</span><br><span class="line">Jupyter</span><br><span class="line">Python</span><br><span class="line">Pylance</span><br></pre></td></tr></table></figure>
<p>然后重启VS Code。 <del>高兴的也可以重启电脑，随便你</del></p>
<h2 id="nb-cli脚手架"><a href="#nb-cli脚手架" class="headerlink" title="nb-cli脚手架"></a>nb-cli脚手架</h2><p>其余安装NoneBot2的方式见<a target="_blank" rel="noopener" href="https://v2.nonebot.dev/docs/start/installation">手册</a>。</p>
<p>按下win键并直接输入cmd，或者用其他什么办法打开命令提示符，输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple nb-cli</span><br></pre></td></tr></table></figure>
<p>这里用的是清华镜像源，<strong>下载速度比直接下载不知道快到哪里去了</strong><br>如有报错，见<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1aZ4y1f7e2?p=3&t=159.1">教程视频</a>。</p>
<p>打开任意文件夹，在左上角<code>文件</code>找到<code>打开Windows PowerShell</code>，输入<code>nb</code>，没有飘红，就表示脚手架安装成功。届时在<code>Show Logo</code>档按回车或者直接关闭PowerShell都可以。<br>如果出现以下红字，请尝试卸载并调整环境变量，再重新安装nb-cli。</p>
<blockquote>
<p>nb : 无法将“nb”项识别为 cmdlet、函数、脚本文件或可运行程序的名称。请检查名称的拼写，如果包括路径，请确保路径正确，然后再试一次。</p>
</blockquote>
<hr>
<h1 id="创建机器人"><a href="#创建机器人" class="headerlink" title="创建机器人"></a>创建机器人</h1><h2 id="使用go-cqhttp"><a href="#使用go-cqhttp" class="headerlink" title="使用go-cqhttp"></a>使用go-cqhttp</h2><p>这么做可以是可以，但对比下来略为繁琐，如果先前有搭建QQ机器人的经验（单纯使用Dice!或其他一键部署的不算），可以选择跳过。<br>因为我个人已经不使用此方法，故这里只放出<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1aZ4y1f7e2?p=5">视频地址</a>，而不进行说明。</p>
<p><strong>后来的补充：因为某些原因，我重新启用了这种做法。详见文章：<a target="_blank" rel="noopener" href="https://lilyblack0930.github.io/2023/03/30/%E4%B8%8B%E8%BD%BD%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84go-cqhttp%E7%84%B6%E5%90%8E%E7%BB%99NoneBot%E6%90%AC%E4%B8%AA%E5%AE%B6%E5%90%A7/">下载新版本的go-cqhttp然后给NoneBot搬个家吧</a></strong></p>
<h2 id="在NoneBot中使用nonebot-plugin-gocqhttp"><a href="#在NoneBot中使用nonebot-plugin-gocqhttp" class="headerlink" title="在NoneBot中使用nonebot-plugin-gocqhttp"></a>在NoneBot中使用nonebot-plugin-gocqhttp</h2><h3 id="创建新项目"><a href="#创建新项目" class="headerlink" title="创建新项目"></a>创建新项目</h3><ol>
<li>打开PowerShell，输入<code>nb create</code>，回车发送。</li>
<li>在询问<code>Project Name</code>时，输入一个自己喜欢的名字，再次回车。</li>
<li>使用键盘“↑”和“↓”键，选中<code>2) In a &quot;src&quot; folder</code>，回车提交。</li>
<li>询问<code>Which builtin plugin(s) would you like to use?</code>，选中<code>echo</code>并按空格勾选，然后提交。</li>
<li>询问<code>Which adapter(s) would you like to use?</code>，仅选中<code>OneBot V11</code>。</li>
</ol>
<h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h3><p>在PowerShell中，输入<code>pip install nonebot-plugin-gocqhttp</code>，等待安装完成。</p>
<h3 id="调整项目环境"><a href="#调整项目环境" class="headerlink" title="调整项目环境"></a>调整项目环境</h3><ol>
<li><p>（可选）用记事本或者VS Code打开项目文件夹中的<code>.env</code>文件，将<code>ENVIRONMENT=dev</code>改为<code>ENVIRONMENT=prod</code>，会少一些debug提示。</p>
</li>
<li><p>打开<code>.env.dev</code>（如果在第一步有更改，则打开<code>.env.prod</code>），进行修改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HOST=127.0.0.1</span><br><span class="line">PORT=51234  # 一个10000-60000之间随机的数字</span><br><span class="line">SUPERUSERS=[&quot;1142145792&quot;, &quot;3259553986&quot;]  # 超级用户</span><br><span class="line">NICKNAME=[&quot;awesome&quot;, &quot;bot&quot;]  # 其实没什么用</span><br><span class="line">COMMAND_START=[&quot;/&quot;,&quot;&quot;]  # 命令开头，可以自己改掉，不推荐设置空&quot;&quot;，建议删了。我这里设置了&quot;.&quot;和&quot;。&quot;</span><br><span class="line">LOG_LEVEL=DEBUG  # 如果是.dev会有这两行</span><br><span class="line">FASTAPI_RELOAD=true  # 不需要动，.prod是没有的</span><br></pre></td></tr></table></figure>
<p><del>不过对于小开发者来说或许不怎么会出现这种现象</del></p>
</li>
<li><p>打开<code>bot.py</code>，在<code>nonebot.load_builtin_plugins(&quot;echo&quot;)</code>行的下方新增一行，写入<code>nonebot.load_plugin(&#39;nonebot_plugin_gocqhttp&#39;)</code>。<br>若运行出现错误，可将<code>nonebot.load_from_toml</code>一行注释掉。</p>
</li>
<li><p>（可选）若使用的是VS Code且电脑存在多个Python环境（例如我就还有个conda），按<code>CTRL+SHIFT+P</code>并输入<code>interpreter</code>，找到选择解释器，将Python解释器更改为正确的路径。</p>
</li>
<li><p>按<code>CTRL+F5</code>，进行以非调试模式运行。</p>
</li>
</ol>
<p>当最终出现<code>Uvicorn running on http:127.0.0.1:XXXXX</code>表示运行成功。</p>
<h3 id="添加账号"><a href="#添加账号" class="headerlink" title="添加账号"></a>添加账号</h3><ol>
<li>打开终端提供的链接（通常为<code>http:127.0.0.1:XXXXX/go-cqhttp</code>），查看WebUI。</li>
<li>选择添加账号，输入QQ号，也可以调整登录设备类型。接下来会使用二维码登录，所以不需要输入QQ密码。</li>
<li>手机登录机器人QQ，然后电脑选中机器人，点击启动，在右方进程日志上将状态切换为实时，出现二维码后进行扫码。若无法识别二维码，可选择使用左侧<code>显示登录二维码</code>。</li>
</ol>
<p>登录完成后，网页可以关闭，无需一直开启。<br>可以对机器人私聊发送<code>[命令开头]echo [内容]</code>，例如<code>/echo 123</code>，来确认机器人是否正常启用。机器人会重复一遍你的话。</p>
<hr>
<h1 id="安装插件-1"><a href="#安装插件-1" class="headerlink" title="安装插件"></a>安装插件</h1><h2 id="第三方插件"><a href="#第三方插件" class="headerlink" title="第三方插件"></a>第三方插件</h2><p>可以在<a target="_blank" rel="noopener" href="https://v2.nonebot.dev/store">插件商店</a>选择自己想要的插件，并复制其指纹（直接复制安装命令存在bug，可以不用）<br>在机器人根目录打开PowerShell，输入<code>nb plugin install 插件名</code><br>……然后就报错了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Could not install packages due to an OSError: [WinError 5] 拒绝访问。: &#x27;c:\\programdata\\anaconda3\\lib\\site-packages\\imageio-2.9.0.dist-info\\direct_url.json&#x27;</span><br><span class="line">Consider using the `--user` option or check the permissions.</span><br></pre></td></tr></table></figure>
<p>原因是拒绝访问，而实际上nb并没有<code>--user</code>这条命令，所以这里使用了<code>pip install 插件名 --user</code>，成功安装。<br>然后与之前一样，在<code>bot.py</code>添加一行<code>nonebot.load_plugin(&#39;插件名&#39;)</code>，重新运行程序，即可启用插件。</p>
<h2 id="自己写的插件"><a href="#自己写的插件" class="headerlink" title="自己写的插件"></a>自己写的插件</h2><h3 id="前置"><a href="#前置" class="headerlink" title="前置"></a>前置</h3><p>在<code>bot.py</code>中加入<code>nonebot.load_plugins(&#39;src/plugins&#39;)</code></p>
<h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><p>在<code>根目录\src\plugins</code>文件夹内创建新的<code>.py</code>文件，名字为插件名</p>
<h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h3><p>在<code>根目录\src\plugins</code>文件夹内创建新的文件夹，内含<code>__init__.py</code>等文件</p>
</p></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-05-08</span><i class="fa fa-tag"></i><a class="tag" href="/tags/NoneBot/" title="NoneBot">NoneBot </a><span class="leancloud_visitors"></span><span>大约1661个字, 5分钟32秒读完</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,http://example.com/2022/05/08/NoneBot搭建经验总结/,兔兔实验室,NoneBot搭建经验总结,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2022/08/19/%E5%85%94%E5%85%94%E9%B1%BC%E5%A1%98%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/" title="兔兔鱼塘改造计划">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2022/05/06/%E5%85%B3%E4%BA%8E%E7%95%99%E8%A8%80%E6%9D%BF%E5%A6%82%E4%BD%95%E5%BB%BA%E8%AE%BE/" title="关于留言板如何建设">下一篇</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(无标题)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="想要查找什么..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>